<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>ManualPreludeDbAdmin - PRELUDE SIEM - UNITY 360</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="Vienoa5Vwe980lqF5KbST1/Q4lp4Q+c1iUN5hBQ6o9tFCM/OZ0HMbPZ4Un/57psRI5uTxGJJvntXzb0UkDqX2A==" />
<link rel='shortcut icon' href='/themes/prelude/favicon/Prelude-icon.png' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css" />
<link rel="stylesheet" media="all" href="/themes/prelude/stylesheets/application.css" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-3.1.4.js"></script>
<script src="/javascripts/application.js"></script>
<script src="/javascripts/responsive.js"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>





  <script src="/plugin_assets/redmine_wiki_extensions/javascripts/jquery.tablesorter.js"></script>
  <link rel="stylesheet" media="screen" href="/plugin_assets/redmine_wiki_extensions/stylesheets/wiki_extensions.css" />
  <link rel="stylesheet" media="print" href="/plugin_assets/redmine_wiki_extensions/stylesheets/wiki_extensions_print.css" />
  <script src="/plugin_assets/redmine_wiki_extensions/javascripts/wiki_extensions.js"></script>

<!-- page specific tags -->
</head>
<body class="theme-Prelude project-prelude controller-wiki action-show">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/prelude/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="wiki_pages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li><li><a class="register" href="/account/register">Register</a></li></ul>    </div>
    
    <ul><li><a class="PreludeOSS" href="/projects/prelude">Prelude OSS</a></li><li><a target="_blank" class="SIEMVersion" href="http://www.prelude-siem.com">Prelude SIEM</a></li><li><a class="VigiloOSS" href="/projects/vigilo-nms">Vigilo OSS</a></li><li><a target="_blank" class="NMSVersion" href="http://www.vigilo-nms.com">Vigilo NMS</a></li><li><a class="|" href="#">|</a></li><li><a class="Projects" href="/projects">Projects</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/prelude/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="wiki_pages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/prelude/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        
    </div>

    <h1>
        <img src="/themes/prelude/img/prelude-logo.png" style="height: 55px"/>
        <a href="https://www.ow2.org/bin/view/Press_Releases/OW2_Open_Source_Community_announces_OW2con_16_Best_Project_Awards" target="_blank"><img src="/themes/prelude/img/ow2-logo.png" style="margin-top: -10px; height: 55px"/></a>
    </h1>

    
    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/prelude">Overview</a></li><li><a class="activity" href="/projects/prelude/activity">Activity</a></li><li><a class="roadmap" href="/projects/prelude/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/prelude/issues">Issues</a></li><li><a class="MyWiki" href="/projects/prelude/wiki">Documentation</a></li><li><a class="boards" href="/projects/prelude/boards">Forums</a></li><li><a class="MyFiles" href="/projects/prelude/files">Downloads</a></li><li><a target="_blank" class="screenshot" href="https://www.prelude-siem.com/prelude-siem/#alerter">Screenshot</a></li><li><a target="_blank" class="IDMEFProbe" href="https://www.prelude-siem.com/en/technological-partners/">IDMEF Probes</a></li><li><a target="_blank" class="PrewikkaApps" href="https://github.com/Prelude-SIEM-Contrib">SIEM Apps</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
            <div class="wiki">
    <ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/ManualUser">Table Of Contents</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeForeword">Foreword</a></li>
		<li><strong>Introduction</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeGlossary">Glossary</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeComponents">Prelude Components</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeArchitecture">Prelude Architecture</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeStandards">Prelude Standards</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeCompatibility">Prelude Compatibility</a></li>
	</ol>
	</li>
		<li><strong>Installation</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeRequirement">Installation Requirements</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPrelude">Installation from sources</a>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeLibrary">Libprelude</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeDbLibrary">LibpreludeDB</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeManager">Prelude Manager</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeCorrelator">Prelude Correlator</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeLml">Prelude LML</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludePrewikka">Prewikka</a></li>
	</ol>
	</li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPackage">Installation from packages</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingVA">Installation from VA</a></li>
		<li>Agents Installation
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingAgentRegistration">Agents Registration</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingAgentThirdparty">3rd Party Agents Installation</a> </li>
	</ol>
	</li>
	</ol>
	</li>
		<li><strong>Configuration</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/ConfigurationGeneral">General Configuration</a></li>
		<li>Prelude Components Configuration
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeManager">Prelude-Manager</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeCorrelator">Prelude-Correlator</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeLml">Prelude-LML</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeImport">Prelude-Import</a></li>
	</ol>
	</li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/HowtoHACentralServices">Howto Configure High Availability Central Services</a></li>
	</ol>
	</li>
		<li><strong>Optimisation</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/DatabaseOptimisation">Database Optimisation</a></li>
	</ol>
	</li>
		<li><strong>User Manuals</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/ManualPrewikka">Prewikka Manual</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/ManualPreludeAdmin">Prelude-Admin Manual</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/ManualPreludeDbAdmin">PreludeDB-Admin Manual</a></li>
	</ol>
	</li>
		<li><strong>Development</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/DevelopmentGuidelines">Development guidelines</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/SourceOrganization">Source organization</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PrewikkaApps">Prewikka Apps</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/DevelAgentQuickly">Prelude Agent</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeAgentContribution">Prelude Agent contribution program</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/LibpreludeAPI">Libprelude API</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/LibpreludedbAPI">Libpreludedb API</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/ContinuousIntegration">Prelude CI</a></li>
	</ol></li>
	</ol>
  </div>

<h3>Wiki</h3>
<ul>
  <li><a href="/projects/prelude/wiki">Start page</a></li>
  <li><a href="/projects/prelude/wiki/index">Index by title</a></li>
  <li><a href="/projects/prelude/wiki/date_index">Index by date</a></li>
</ul>


        
    </div>

    <div id="content">
        
        <div class="contextual">
  
  
  
  
  
  

</div>

<p class="breadcrumb"><a href="/projects/prelude/wiki/ManualUser">ManualUser</a> » </p>


<div class="wiki wiki-page">
  <a name="PreludeDB-Admin-Manual"></a>
<h1 >PreludeDB-Admin Manual<a href="#PreludeDB-Admin-Manual" class="wiki-anchor">&para;</a></h1>


	<a name="Table-of-Contents"></a>
<h3 >Table of Contents<a href="#Table-of-Contents" class="wiki-anchor">&para;</a></h3>


	<ul class="toc"><li><a href="#PreludeDB-Admin-Manual">PreludeDB-Admin Manual</a><ul><li><ul><li><a href="#Table-of-Contents">Table of Contents</a></li></ul>
</li><li><a href="#Presentation">Presentation</a><ul><li><a href="#Database-settings">Database settings</a></li><li><a href="#Various-options">Various options</a></li></ul>
</li><li><a href="#Removing-events">Removing events</a></li><li><a href="#Automatically-removing-events-older-than-">Automatically removing events older than ..</a></li><li><a href="#Copy-or-Move-events-to-another-database">Copy or Move events to another database</a></li><li><a href="#Save-event-to-a-file">Save event to a file</a></li><li><a href="#Load-event-from-a-file">Load event from a file</a></li><li><a href="#Print-database-events">Print database events</a></li></ul></li></ul>


	<a name="Presentation"></a>
<h2 >Presentation<a href="#Presentation" class="wiki-anchor">&para;</a></h2>


	<p><strong>preludedb-admin</strong> can be used to perform various operation on the Prelude IDMEF database. It support moving/copying data between database, exporting event from a database, restoring event in a database, events deletion and printing.</p>


	<p>Run preludedb-admin with no argument to get a listing of available commands. By specifying a command with no argument, you can get a detailed help and example concerning the command.</p>


	<a name="Database-settings"></a>
<h3 >Database settings<a href="#Database-settings" class="wiki-anchor">&para;</a></h3>


	<p>All preludedb-admin command require database settings to be provided, in order for the tool to access the database. Database settings are a string of key=value pair, made of the following key:</p>


	<ul>
	<li>type

	<p>Type of the database (mysql, pgsql, sqlite).</p></li>
	</ul>


	<ul>
	<li>name

	<p>Name of the database</p></li>
	</ul>


	<ul>
	<li>user

	<p>Username to use to access the database</p></li>
	</ul>


	<ul>
	<li>pass

	<p>Password to use to access the database</p></li>
	</ul>


	<ul>
	<li>host

	<p>Optional host where the database should be contacted (default is localhost).</p></li>
	</ul>


	<ul>
	<li>port

	<p>Optional port where the database should be contacted (default depend on the selected database <em>type</em>).</p></li>
	</ul>


	<p>Database settings example, to access a <a class="wiki-page new" href="/projects/prelude/wiki/MySQL?parent=ManualPreludeDbAdmin">MySQL</a> database named prelude:</p>


<pre>
"type=mysql name=prelude user=prelude pass=prelude" 
</pre>

	<a name="Various-options"></a>
<h3 >Various options<a href="#Various-options" class="wiki-anchor">&para;</a></h3>


	<p>A number of options, compatible with all preludedb-admin command, are available:</p>


	<ul>
	<li>--*offset*

	<p>Skip processing until 'offset' events.</p></li>
	</ul>


	<ul>
	<li>--*count*

	<p>Process at most this number of events.</p></li>
	</ul>


	<ul>
	<li>--*query-logging*

	<p>Log SQL query to the specified file.</p></li>
	</ul>


	<ul>
	<li>--*criteria*

	<p>Only process events that match the provided <a class="wiki-page" href="/projects/prelude/wiki/IDMEFCriteria">criteria</a>.</p></li>
	</ul>


	<ul>
	<li>--*events-per-transaction*

	<p>By default, preludedb-admin will surround multiples write/deletion command to the database by a transaction, allowing to rollback in case of error. The number of events to process before flushing the transaction can be controlled using this option. Higher value provide improved performance, at the price of an higher memory pressure. The default is to process 1000 events per transaction.</p></li>
	</ul>


	<a name="Removing-events"></a>
<h2 >Removing events<a href="#Removing-events" class="wiki-anchor">&para;</a></h2>


	<p>In order to delete events from a specific database, you might use the <strong>delete</strong> command. Note that the criteria argument is mandatory for the delete command, since providing no criteria would result in the whole database being deleted.</p>


	<p>Example for flushing any event created before a specific date:<br /><pre>
preludedb-admin delete alert --criteria "alert.create_time &lt; YYYY-MM-DD" "type=mysql name=prelude user=prelude pass=prelude" 
</pre></p>


	<p><strong>Note</strong>: If you are using the <a class="wiki-page new" href="/projects/prelude/wiki/MySQL?parent=ManualPreludeDbAdmin">MySQL</a> InnoDB database engine, keep in mind that deletion of old events does not shrink the database size. In order to shrink an <a class="wiki-page new" href="/projects/prelude/wiki/InnoDB?parent=ManualPreludeDbAdmin">InnoDB</a> database, you can save the whole database using the mysqldump tool, drop the database, and rebuild it using the previously generated backup.</p>


	<a name="Automatically-removing-events-older-than-"></a>
<h2 >Automatically removing events older than ..<a href="#Automatically-removing-events-older-than-" class="wiki-anchor">&para;</a></h2>


	<p>As explained above, you to use preludedb-admin with a 'string'  of parameters that perform the wanted actions, amongst other delete given alerts from the database. This is a manual task, and the following bash script allows to automate these tasks for the given context: Remove alerts older than ...</p>


	<p>Please note that the bash script is only an example for deleting alerts older than 30 days. When added to a cron job running daily for example, your alerts dataase will only contain alerts younger than 30 days. and is only valid for Linux based systems that can use the date command.</p>


<pre>
#!/bin/sh
DATE=$(date -d "last month" +"%Y-%m-%d")
preludedb-admin delete alert "type=pgsql name=prelude user=prelude pass=prelude" --criteria "alert.create_time &lt; $DATE" 
</pre>

	<p>How it works: date <del>d "last month" will take the current date and substract 30 days, the +"%Y</del>%m-%d" formats the output of the date command in the right format for libpreludedb-admin.</p>


	<p>Date examples: -d "10 days", -d "2 weeks", -d "last year", ...</p>


	<p>Adjust the prelude-db admin command to suit your needs and your configuration.</p>


	<a name="Copy-or-Move-events-to-another-database"></a>
<h2 >Copy or Move events to another database<a href="#Copy-or-Move-events-to-another-database" class="wiki-anchor">&para;</a></h2>


	<p>Using preludedb-admin, it is possible to easily copy or move data between database. Additional option might be specified, for example, you might want to provide an IDMEFCriteria using the --*criteria* option, or define a specific limit or offset.</p>


<pre>
preludedb-admin copy alert "type=mysql name=prelude user=prelude pass=prelude" "host=pgsql.host type=pgsql name=prelude pass=prelude" 
preludedb-admin copy heartbeat "type=mysql name=prelude user=prelude pass=prelude" "host=pgsql.host type=pgsql name=prelude pass=prelude" 
</pre>

	<p>The command used to move data to another database is mostly the same:<br /><pre>
preludedb-admin move alert "type=mysql name=prelude user=prelude pass=prelude" "host=pgsql.host type=pgsql name=prelude pass=prelude" 
preludedb-admin move heartbeat "type=mysql name=prelude user=prelude pass=prelude" "host=pgsql.host type=pgsql name=prelude pass=prelude" 
</pre></p>


	<a name="Save-event-to-a-file"></a>
<h2 >Save event to a file<a href="#Save-event-to-a-file" class="wiki-anchor">&para;</a></h2>


	<p>Using the preludedb-admin <strong>save</strong> command, you can retrieve events from a database and store them in a file. The format is a binary, machine independant Prelude format, thus the generated file can be transfered on another machine without compatibility issue. If you do not specify an output filename on the command line, then then data will be directly written to the standard output.</p>


	<p>Example to retrieve every database alerts, and store them in the <em>alert.out</em> file:<br /><pre>
$ preludedb-admin save alert "type=mysql name=prelude user=prelude pass=prelude" alert.out
</pre></p>


	<a name="Load-event-from-a-file"></a>
<h2 >Load event from a file<a href="#Load-event-from-a-file" class="wiki-anchor">&para;</a></h2>


	<p>Event saved through the <em>preludedb-admin save</em> command can be imported into the Prelude database again. If no filename is provided, preludedb-admin will attempt to read from standard input.</p>


<pre>
$ preludedb-admin load "type=mysql user=root pass=root name=xlr" alert.out
</pre>

	<a name="Print-database-events"></a>
<h2 >Print database events<a href="#Print-database-events" class="wiki-anchor">&para;</a></h2>


<pre>
$ preludedb-admin print alert "type=mysql user=prelude pass=prelude name=prelude" --count 1
alert:
        messageid: 898ac484-4bd2-11dd-a208
        analyzer(0): 
                analyzerid: 2012219155818466
                name: prelude-manager
                manufacturer: http://www.prelude-ids.com
                model: Prelude Manager
                version: 0.9.12.1
                class: Concentrator
                ostype: Linux
                osversion: 2.6.24.5-85.fc8
                node:
                        category: hosts (6)
                        location: Paris
...
</pre>

	<p></p>


<div id="wiki_extentions_footer">

	<p><em>© <a href="http://www.c-s.fr" class="external">CS GROUP</a> 2012-2020</em></p>


</div>
</div>








        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
<!-- Piwik -->
<noscript><p><img src="//www.prelude-siem.org/piwik/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
<script type="text/javascript">
  var piwik_site_id = '3';

  var _paq = _paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
  _paq.push(["setCookieDomain", "*.dev.prelude-ids.com"]);
  _paq.push(["setDomains", ["*.dev.prelude-ids.com","*.prelude-ids.org","*.prelude-siem.org","*.www.prelude-ids.org","*.www.prelude-siem.org", "*.vigilo-nms.org", "*.www.vigilo-nms.org"]]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//www.prelude-siem.org/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', piwik_site_id]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2017 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111535491-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111535491-5');
</script>
 


    <script type="text/javascript">


    </script>
    <script>
//<![CDATA[
wiki_extension_create_table_header();
//]]>
</script>


</body>
</html>
