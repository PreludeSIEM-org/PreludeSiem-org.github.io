<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>HowtoHACentralServices - PRELUDE SIEM - UNITY 360</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="VVepN1o6p0911v4+qXJJlNv/dNLouliR5T8gwh7Dl/dGeMFYky6qzP989sS0OgDKp7QFTPKwAd87seRSmsOj9A==" />
<link rel='shortcut icon' href='/themes/prelude/favicon/Prelude-icon.png' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css" />
<link rel="stylesheet" media="all" href="/themes/prelude/stylesheets/application.css" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-3.1.4.js"></script>
<script src="/javascripts/application.js"></script>
<script src="/javascripts/responsive.js"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>





  <script src="/plugin_assets/redmine_wiki_extensions/javascripts/jquery.tablesorter.js"></script>
  <link rel="stylesheet" media="screen" href="/plugin_assets/redmine_wiki_extensions/stylesheets/wiki_extensions.css" />
  <link rel="stylesheet" media="print" href="/plugin_assets/redmine_wiki_extensions/stylesheets/wiki_extensions_print.css" />
  <script src="/plugin_assets/redmine_wiki_extensions/javascripts/wiki_extensions.js"></script>

<!-- page specific tags -->
</head>
<body class="theme-Prelude project-prelude controller-wiki action-show">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/prelude/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="wiki_pages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li><li><a class="register" href="/account/register">Register</a></li></ul>    </div>
    
    <ul><li><a class="PreludeOSS" href="/projects/prelude">Prelude OSS</a></li><li><a target="_blank" class="SIEMVersion" href="http://www.prelude-siem.com">Prelude SIEM</a></li><li><a class="VigiloOSS" href="/projects/vigilo-nms">Vigilo OSS</a></li><li><a target="_blank" class="NMSVersion" href="http://www.vigilo-nms.com">Vigilo NMS</a></li><li><a class="|" href="#">|</a></li><li><a class="Projects" href="/projects">Projects</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/prelude/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="wiki_pages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/prelude/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        
    </div>

    <h1>
        <img src="/themes/prelude/img/prelude-logo.png" style="height: 55px"/>
        <a href="https://www.ow2.org/bin/view/Press_Releases/OW2_Open_Source_Community_announces_OW2con_16_Best_Project_Awards" target="_blank"><img src="/themes/prelude/img/ow2-logo.png" style="margin-top: -10px; height: 55px"/></a>
    </h1>

    
    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/prelude">Overview</a></li><li><a class="activity" href="/projects/prelude/activity">Activity</a></li><li><a class="roadmap" href="/projects/prelude/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/prelude/issues">Issues</a></li><li><a class="MyWiki" href="/projects/prelude/wiki">Documentation</a></li><li><a class="boards" href="/projects/prelude/boards">Forums</a></li><li><a class="MyFiles" href="/projects/prelude/files">Downloads</a></li><li><a target="_blank" class="screenshot" href="https://www.prelude-siem.com/prelude-siem/#alerter">Screenshot</a></li><li><a target="_blank" class="IDMEFProbe" href="https://www.prelude-siem.com/en/technological-partners/">IDMEF Probes</a></li><li><a target="_blank" class="PrewikkaApps" href="https://github.com/Prelude-SIEM-Contrib">SIEM Apps</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
            <div class="wiki">
    <ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/ManualUser">Table Of Contents</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeForeword">Foreword</a></li>
		<li><strong>Introduction</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeGlossary">Glossary</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeComponents">Prelude Components</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeArchitecture">Prelude Architecture</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeStandards">Prelude Standards</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeCompatibility">Prelude Compatibility</a></li>
	</ol>
	</li>
		<li><strong>Installation</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeRequirement">Installation Requirements</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPrelude">Installation from sources</a>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeLibrary">Libprelude</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeDbLibrary">LibpreludeDB</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeManager">Prelude Manager</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeCorrelator">Prelude Correlator</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeLml">Prelude LML</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludePrewikka">Prewikka</a></li>
	</ol>
	</li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPackage">Installation from packages</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingVA">Installation from VA</a></li>
		<li>Agents Installation
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingAgentRegistration">Agents Registration</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingAgentThirdparty">3rd Party Agents Installation</a> </li>
	</ol>
	</li>
	</ol>
	</li>
		<li><strong>Configuration</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/ConfigurationGeneral">General Configuration</a></li>
		<li>Prelude Components Configuration
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeManager">Prelude-Manager</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeCorrelator">Prelude-Correlator</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeLml">Prelude-LML</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeImport">Prelude-Import</a></li>
	</ol>
	</li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/HowtoHACentralServices">Howto Configure High Availability Central Services</a></li>
	</ol>
	</li>
		<li><strong>Optimisation</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/DatabaseOptimisation">Database Optimisation</a></li>
	</ol>
	</li>
		<li><strong>User Manuals</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/ManualPrewikka">Prewikka Manual</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/ManualPreludeAdmin">Prelude-Admin Manual</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/ManualPreludeDbAdmin">PreludeDB-Admin Manual</a></li>
	</ol>
	</li>
		<li><strong>Development</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/DevelopmentGuidelines">Development guidelines</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/SourceOrganization">Source organization</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PrewikkaApps">Prewikka Apps</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/DevelAgentQuickly">Prelude Agent</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeAgentContribution">Prelude Agent contribution program</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/LibpreludeAPI">Libprelude API</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/LibpreludedbAPI">Libpreludedb API</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/ContinuousIntegration">Prelude CI</a></li>
	</ol></li>
	</ol>
  </div>

<h3>Wiki</h3>
<ul>
  <li><a href="/projects/prelude/wiki">Start page</a></li>
  <li><a href="/projects/prelude/wiki/index">Index by title</a></li>
  <li><a href="/projects/prelude/wiki/date_index">Index by date</a></li>
</ul>


        
    </div>

    <div id="content">
        
        <div class="contextual">
  
  
  
  
  
  

</div>

<p class="breadcrumb"><a href="/projects/prelude/wiki/ManualUser">ManualUser</a> » </p>


<div class="wiki wiki-page">
  <a name="Howto-Configure-High-Availability-Prelude-Central-Services"></a>
<h1 >Howto Configure High Availability Prelude Central Services<a href="#Howto-Configure-High-Availability-Prelude-Central-Services" class="wiki-anchor">&para;</a></h1>


	<p>This is an example configuration utilizing two machines to provide a high availability pair for the central Prelude services, which include: <a class="wiki-page" href="/projects/prelude/wiki/PreludeManager">Prelude-Manager</a> <a class="wiki-page" href="/projects/prelude/wiki/PreludeCorrelator">Prelude-Correlator</a>, <a class="wiki-page" href="/projects/prelude/wiki/Prewikka">Prewikka</a>, and MySQL.</p>


	<p><strong>Table of Contents</strong></p>


	<ul class="toc"><li><a href="#Howto-Configure-High-Availability-Prelude-Central-Services">Howto Configure High Availability Prelude Central Services</a><ul><li><a href="#MySQL-Multi-Master-Replication-Configuration">MySQL Multi-Master Replication Configuration</a></li><li><a href="#Prelude-Central-Components">Prelude Central Components</a></li><li><a href="#Setting-up-the-Heartbeat-Pair">Setting up the Heartbeat Pair</a></li><li><a href="#Service-Monitoring">Service Monitoring</a></li><li><a href="#Clients-Relays-Agents">Clients / Relays / Agents</a></li></ul></li></ul>


	<p>Heartbeat will control the failing over of hard failures, such as a machine going down or total loss of connectivity.  Both servers will maintain an up-to-date set of databases, and either can take over at a moments notice as the primary.  You will need to use some form of monitoring, such as Nagios to handle service failures - thus alerting you when a manual failover is required (such as if a particular service dies, but the hardware remains operational and reachable).</p>


<strong>Things that are assumed:</strong>
	<ul>
	<li>You will need at least two ethernet interfaces per server (and two servers).</li>
		<li>Assumes you have eth0 configured with IP/hostnames on both boxes.  This example uses preludecentral_1 and preludecentral_2, and a VIP (virtual IP) with associated hostname, such as preludecentral.  Make sure you also add the VIP/hostname to DNS/host/etc., as this is what you expose to your clients/relays/agents/etc.</li>
		<li>This document assumes high availability for fault tolerance, not for performance.  Although you could stagger which services are offered where, etc.</li>
	</ul>


	<a name="MySQL-Multi-Master-Replication-Configuration"></a>
<h2 >MySQL Multi-Master Replication Configuration<a href="#MySQL-Multi-Master-Replication-Configuration" class="wiki-anchor">&para;</a></h2>


	<p><strong>You must have installed MySQL v5.x or above. Some features to avoid collisions in multi-master replication are only available in MySQL v5.x</strong></p>


1. Setup secondary ethernet interfaces
	<ul>
	<li>Setup eth1 on each server to be an unused private network for use by your HA pair.</li>
		<li>Connect with a crossover cable between them.</li>
	</ul>


	<p>2. Make the following additions on both servers in /etc/my.cnf, under [mysqld] section:</p>


<pre>
      wait_timeout=259200
      interactive_timeout=259200
      max_connections=200

      log-bin=&lt;$HOSTNAME&gt;-mysql-bin  #change hostname to be each machines hostname

      server-id={1,2}  #set one server for 1 and the other for 2

      auto_increment_increment=2
      auto_increment_offset={1,2}  #set one server for 1 and the other for 2

      # Timeouts and max connections have been increased to handle a client disconnect issue.

      # Various other settings can be adjusted to the specs of your machine, such as buffer sizes, log sizes, etc.
</pre>

	<p>3. Change datadir in /etc/my.cnf to be on a partition of its own of acceptable size, edit /etc/fstab, and add "async,noatime" as options for the partition used for the MySQL database directory.</p>


4. Run mysql on each server:
	<ul>
	<li>Enter at prompt: GRANT REPLICATION SLAVE on *.* TO some_replication_user IDENTIFIED by 'putreplicationpasswordhere';</li>
	</ul>


5. Add to the end of the mysql binary line in the start section of /etc/init.d/mysqld
	<ul>
	<li>--relay-log=<$HOSTNAME>-relay-bin  #make sure to specify the correct hostname</li>
	</ul>


	<p>6. From each server's mysql command-line: show master status;</p>


	<p>7. From each server's mysql command-line: change master to master_host='&lt;other hosts eth1 private ip address&gt;', master_user='&lt;username setup earlier for replication&gt;', master_password='&lt;password used earlier for replication&gt;', master_log_file='&lt;output of 1st column from above step on other server', master_log_pos=&lt;output of 2nd column from above step on other server&gt;;</p>


	<p>8. Restart mysqld on each of the servers</p>


9. Configure a root mysql password from the mysql command-line (only needs to be done on one server):
	<ul>
	<li>SET password for root@localhost=password('putmysqlrootpasswordhere');</li>
		<li>FLUSH PRIVILEGES;</li>
	</ul>


	<a name="Prelude-Central-Components"></a>
<h2 >Prelude Central Components<a href="#Prelude-Central-Components" class="wiki-anchor">&para;</a></h2>


	<p>1.  You must install <a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeLibrary">Libprelude</a> <a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeDbLibrary">LibpreludeDB</a> <a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeManager">Prelude-Manager</a> <a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeCorrelator">Prelude-Correlator</a> and <a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludePrewikka">Prewikka</a> on both machines.</p>


	<p>2.  All of the central Prelude services should have the same configuration files on both servers (ie. prelude-manager, prelude-correlator, apache, etc.)</p>


	<p>3.  When importing the prelude and prewikka schemas to their respective databases, it only needs to be done on one of the servers, it will be replicated to the other automatically.</p>


	<p>4. Copy over profiles (if you have a Prelude Central already setup) or register for all profiles needed: correlator, manager, prewikka.  Do this on one server, then copy those profiles/directories under /usr/local/etc/prelude/profile/ of the other machine in the HA pair.</p>


	<p>5. Edit /usr/local/etc/prelude/default/global.conf, make 'Node Name' the name of the VIPs hostname on both.  Copy over to other HA server.</p>


	<p>6. Your web server and MySQL should be set to start automatically on boot.  Prelude Manager and Correlator should NOT be set to start automatically on boot, as Heartbeat will handle these two services.</p>


	<a name="Setting-up-the-Heartbeat-Pair"></a>
<h2 >Setting up the Heartbeat Pair<a href="#Setting-up-the-Heartbeat-Pair" class="wiki-anchor">&para;</a></h2>


1. Heartbeat Configuration
	<ul>
	<li>Install heartbeat, and all packages necessary such as stonih, pils, etc. that are required by your package manager.</li>
		<li>Configure heartbeat to start on boot.</li>
		<li>Create /etc/ha.d/ha.cf:</li>
	</ul>


<pre>
      debugfile /var/log/ha-debug
      logfile /var/log/ha-log
      logfacility     local0
      keepalive 2
      auto_failback off
      deadtime 30
      bcast eth1 eth0
      node    preludecentral_1
      node    preludecentral_2
</pre>

	<ul>
	<li>Create /etc/ha.d/haresources:</li>
	</ul>


<pre>
preludecentral_1 IPaddr::192.168.1.25 prelude-manager prelude-correlator
</pre>

	<p><em>Use your primary hostname, assumes 192.168.1.25 is your VIP, and that you called your init scripts prelude-manager and prelude-correlator</em></p>


	<ul>
	<li>Create /etc/ha.d/authkeys; make sure to chmod 600 it</li>
	</ul>


<pre>
      auth 1
      1 sha1 some_password
</pre>

	<p>2. Set the Heartbeat service to start on boot automatically.</p>


	<a name="Service-Monitoring"></a>
<h2 >Service Monitoring<a href="#Service-Monitoring" class="wiki-anchor">&para;</a></h2>


1. Setup SNMP monitoring with something such as Nagios
	<ul>
	<li>For the VIP hostname/IP
	<ul>
	<li>Ping
	<ul>
	<li>Apache</li>
		<li>Prelude Manager</li>
		<li>Prelude Correlator</li>
		<li>Prewikka Ctl</li>
		<li>TCP Port 4690</li>
	</ul>
	</li>
		<li>For each hostname/IP of the pair
	<ul>
	<li>Ping</li>
		<li>Diskspace</li>
		<li>MySQL</li>
		<li>Heartbeat</li>
	</ul></li>
	</ul></li>
	</ul>


	<p>2. Set the snmpd service to start on boot automatically.</p>


	<a name="Clients-Relays-Agents"></a>
<h2 >Clients / Relays / Agents<a href="#Clients-Relays-Agents" class="wiki-anchor">&para;</a></h2>


	<p>Make sure all clients, agents, relays, etc. connect to your VIP hostname/IP.</p>


	<p></p>


<div id="wiki_extentions_footer">

	<p><em>© <a href="http://www.c-s.fr" class="external">CS GROUP</a> 2012-2020</em></p>


</div>
</div>








        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
<!-- Piwik -->
<noscript><p><img src="//www.prelude-siem.org/piwik/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
<script type="text/javascript">
  var piwik_site_id = '3';

  var _paq = _paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
  _paq.push(["setCookieDomain", "*.dev.prelude-ids.com"]);
  _paq.push(["setDomains", ["*.dev.prelude-ids.com","*.prelude-ids.org","*.prelude-siem.org","*.www.prelude-ids.org","*.www.prelude-siem.org", "*.vigilo-nms.org", "*.www.vigilo-nms.org"]]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//www.prelude-siem.org/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', piwik_site_id]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2017 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111535491-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111535491-5');
</script>
 


    <script type="text/javascript">


    </script>
    <script>
//<![CDATA[
wiki_extension_create_table_header();
//]]>
</script>


</body>
</html>
