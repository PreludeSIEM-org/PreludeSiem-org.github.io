<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>InstallingAgentRegistration - PRELUDE SIEM - UNITY 360</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="SbvRhh2yv5DrpBku/zD6koUh6lCELIVYrhD1/WQPFj9alLnp1KayE2EOEdTieLPM+Wqbzp4m3BZwnjFt4A8iPA==" />
<link rel='shortcut icon' href='/themes/prelude/favicon/Prelude-icon.png' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css" />
<link rel="stylesheet" media="all" href="/themes/prelude/stylesheets/application.css" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-3.1.4.js"></script>
<script src="/javascripts/application.js"></script>
<script src="/javascripts/responsive.js"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>





  <script src="/plugin_assets/redmine_wiki_extensions/javascripts/jquery.tablesorter.js"></script>
  <link rel="stylesheet" media="screen" href="/plugin_assets/redmine_wiki_extensions/stylesheets/wiki_extensions.css" />
  <link rel="stylesheet" media="print" href="/plugin_assets/redmine_wiki_extensions/stylesheets/wiki_extensions_print.css" />
  <script src="/plugin_assets/redmine_wiki_extensions/javascripts/wiki_extensions.js"></script>

<!-- page specific tags -->
</head>
<body class="theme-Prelude project-prelude controller-wiki action-show">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/prelude/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="wiki_pages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li><li><a class="register" href="/account/register">Register</a></li></ul>    </div>
    
    <ul><li><a class="PreludeOSS" href="/projects/prelude">Prelude OSS</a></li><li><a target="_blank" class="SIEMVersion" href="http://www.prelude-siem.com">Prelude SIEM</a></li><li><a class="VigiloOSS" href="/projects/vigilo-nms">Vigilo OSS</a></li><li><a target="_blank" class="NMSVersion" href="http://www.vigilo-nms.com">Vigilo NMS</a></li><li><a class="|" href="#">|</a></li><li><a class="Projects" href="/projects">Projects</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/prelude/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="wiki_pages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/prelude/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        
    </div>

    <h1>
        <img src="/themes/prelude/img/prelude-logo.png" style="height: 55px"/>
        <a href="https://www.ow2.org/bin/view/Press_Releases/OW2_Open_Source_Community_announces_OW2con_16_Best_Project_Awards" target="_blank"><img src="/themes/prelude/img/ow2-logo.png" style="margin-top: -10px; height: 55px"/></a>
    </h1>

    
    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/prelude">Overview</a></li><li><a class="activity" href="/projects/prelude/activity">Activity</a></li><li><a class="roadmap" href="/projects/prelude/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/prelude/issues">Issues</a></li><li><a class="MyWiki" href="/projects/prelude/wiki">Documentation</a></li><li><a class="boards" href="/projects/prelude/boards">Forums</a></li><li><a class="MyFiles" href="/projects/prelude/files">Downloads</a></li><li><a target="_blank" class="screenshot" href="https://www.prelude-siem.com/prelude-siem/#alerter">Screenshot</a></li><li><a target="_blank" class="IDMEFProbe" href="https://www.prelude-siem.com/en/technological-partners/">IDMEF Probes</a></li><li><a target="_blank" class="PrewikkaApps" href="https://github.com/Prelude-SIEM-Contrib">SIEM Apps</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
            <div class="wiki">
    <ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/ManualUser">Table Of Contents</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeForeword">Foreword</a></li>
		<li><strong>Introduction</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeGlossary">Glossary</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeComponents">Prelude Components</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeArchitecture">Prelude Architecture</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeStandards">Prelude Standards</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeCompatibility">Prelude Compatibility</a></li>
	</ol>
	</li>
		<li><strong>Installation</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeRequirement">Installation Requirements</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPrelude">Installation from sources</a>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeLibrary">Libprelude</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeDbLibrary">LibpreludeDB</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeManager">Prelude Manager</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeCorrelator">Prelude Correlator</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludeLml">Prelude LML</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPreludePrewikka">Prewikka</a></li>
	</ol>
	</li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingPackage">Installation from packages</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingVA">Installation from VA</a></li>
		<li>Agents Installation
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingAgentRegistration">Agents Registration</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/InstallingAgentThirdparty">3rd Party Agents Installation</a> </li>
	</ol>
	</li>
	</ol>
	</li>
		<li><strong>Configuration</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/ConfigurationGeneral">General Configuration</a></li>
		<li>Prelude Components Configuration
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeManager">Prelude-Manager</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeCorrelator">Prelude-Correlator</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeLml">Prelude-LML</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeImport">Prelude-Import</a></li>
	</ol>
	</li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/HowtoHACentralServices">Howto Configure High Availability Central Services</a></li>
	</ol>
	</li>
		<li><strong>Optimisation</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/DatabaseOptimisation">Database Optimisation</a></li>
	</ol>
	</li>
		<li><strong>User Manuals</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/ManualPrewikka">Prewikka Manual</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/ManualPreludeAdmin">Prelude-Admin Manual</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/ManualPreludeDbAdmin">PreludeDB-Admin Manual</a></li>
	</ol>
	</li>
		<li><strong>Development</strong>
	<ol>
	<li><a class="wiki-page" href="/projects/prelude/wiki/DevelopmentGuidelines">Development guidelines</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/SourceOrganization">Source organization</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PrewikkaApps">Prewikka Apps</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/DevelAgentQuickly">Prelude Agent</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/PreludeAgentContribution">Prelude Agent contribution program</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/LibpreludeAPI">Libprelude API</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/LibpreludedbAPI">Libpreludedb API</a></li>
		<li><a class="wiki-page" href="/projects/prelude/wiki/ContinuousIntegration">Prelude CI</a></li>
	</ol></li>
	</ol>
  </div>

<h3>Wiki</h3>
<ul>
  <li><a href="/projects/prelude/wiki">Start page</a></li>
  <li><a href="/projects/prelude/wiki/index">Index by title</a></li>
  <li><a href="/projects/prelude/wiki/date_index">Index by date</a></li>
</ul>


        
    </div>

    <div id="content">
        
        <div class="contextual">
  
  
  
  
  
  

</div>

<p class="breadcrumb"><a href="/projects/prelude/wiki/ManualUser">ManualUser</a> » <a href="/projects/prelude/wiki/AgentsInstallation">AgentsInstallation</a> » </p>


<div class="wiki wiki-page">
  <a name="Agent-Registration"></a>
<h1 >Agent Registration<a href="#Agent-Registration" class="wiki-anchor">&para;</a></h1>


	<p><strong>Table of Contents</strong></p>


	<ul class="toc"><li><a href="#Agent-Registration">Agent Registration</a><ul><li><a href="#Registration">Registration</a></li><li><a href="#Profile">Profile</a></li><li><a href="#Agent-Registration-Profile-Creation">Agent Registration / Profile Creation</a><ul><li><a href="#Requested-Permission">Requested Permission</a></li><li><a href="#Manager-Addresses">Manager Addresses</a></li></ul>
</li><li><a href="#Prelude-LML-Registration-example">Prelude-LML Registration example</a></li></ul></li></ul>


	<p><span style="color:red;">As of libprelude 0.9.15, <strong>prelude-adduser</strong> is deprecated. Please now use <strong>prelude-admin</strong>, as specified in the documentation.</span></p>


	<a name="Registration"></a>
<h2 >Registration<a href="#Registration" class="wiki-anchor">&para;</a></h2>


	<p>In order for an agent to connect and communicate with a _Prelude-Manager', it needs to be registered. Registration involves several steps:</p>


	<ul>
	<li>Allocating an unique identity for the sensor</li>
		<li>Creating directory to be used by the sensor (example: failover purpose)</li>
		<li>Registering to a remote <em>Prelude-Manager</em>: get a signed X509 certificate that will allows communication between sensor and manager using the specified permissions.</li>
	</ul>


	<p>All these informations are stored in a sensor 'profile'.</p>


	<a name="Profile"></a>
<h2 >Profile<a href="#Profile" class="wiki-anchor">&para;</a></h2>


	<p>A sensor profile is identified by its name. When a sensor is started, it will try to load a profile of the same name as the program itself, that is, if your sensor is named "prelude-lml", the sensor will try to load a profile named "prelude-lml".</p>


	<p>The name of the profile can be overriden using the <em>--prelude --profile name_of_my_profile</em> command line option. We provide the ability of defining the profile name so that you can have multiples instances of one sensor running with different permissions, which require different profiles.</p>


	<p>Note that profiles are not specific to sensor, but are used in all programs of the Prelude suite (sensors, managers, etc).</p>


	<a name="Agent-Registration-Profile-Creation"></a>
<h2 >Agent Registration / Profile Creation<a href="#Agent-Registration-Profile-Creation" class="wiki-anchor">&para;</a></h2>


	<p>The agent registration process is driven by a single tool called prelude-admin.</p>


<pre>
   $ prelude-admin register &lt;profile name&gt; &lt;requested permission&gt; &lt;manager address&gt; --uid &lt;uid&gt; --gid &lt;gid&gt;
</code></pre>

	<p>Replace <strong>&lt;profile name&gt;</strong> with the name of the sensor you are installing, or with your own defined name if you want more advanced sensor profile control. If you start your sensor without it being registered, it will show you a warning including the default profile name to be used for registering the sensor.</p>


	<p>Remember to use the correct uid/gid when registering your sensor. For instance, if you want to register <em>snort</em> (running with <em>snort</em> euid / egid), use <strong>--uid snort --gid snort</strong>. If the sensor process cannot read the created profiles information (key, cert...), you will get an error and the sensor will refuse to start.</p>


	<p>The first time an agent is registered, <strong>prelude-admin</strong> will need to create a private key for the agent. Under Linux, the operation can take a very long time due to the entropy generation system: advises on fixing this problem are available on the <a class="wiki-page" href="/projects/prelude/wiki/MiscEntropy">Misc/Entropy</a> page.</p>


	<a name="Requested-Permission"></a>
<h3 >Requested Permission<a href="#Requested-Permission" class="wiki-anchor">&para;</a></h3>


Replace <strong>&lt;requested permission&gt;</strong> with the permission your sensor needs. There are several kind of permission:
	<ul>
	<li>idmef</li>
		<li>admin</li>
	</ul>


	<p>Both <em>idmef</em> and <em>admin</em> type can take <strong>read</strong> (<em>r</em>) and <strong>write</strong> (<em>w</em>) permission. Usually, a sensor need permission of writing IDMEF messages to a manager, and optionally accept administrative command sent to the sensors. That is : <strong>idmef:w admin:r</strong>.</p>


	<p><strong>Note</strong>: If you are not sure which permission your sensor should get, just start the sensor, which should then provide you with the <em>prelude-admin</em> options to use for registration.</p>


	<a name="Manager-Addresses"></a>
<h3 >Manager Addresses<a href="#Manager-Addresses" class="wiki-anchor">&para;</a></h3>


	<p>You should replace the <strong>&lt;manager address&gt;</strong> argument by the address where the prelude-manager you wish to register to is running, this can either be its IP address or its hostname name. Typically, if you made a local installation, you can write <strong>localhost</strong> there.</p>


	<p>You need to repeat this step for each manager you want to register the sensor.<br /><strong>When you are not sure about how your sensor should be registered, just start the sensor, which should then provide you with the <em>prelude-admin</em> options to use for registering it</strong>:</p>


<pre>
prelude-client-profile: error creating prelude-client: Could not open [[AnalyzerID]] file.

Basic file configuration does not exist. Please run :
prelude-admin register prelude-lml "idmef:w admin:r" &lt;manager address&gt; --uid 1000 --gid 100
program to setup the analyzer.

Be aware that you should replace the "&lt;manager address&gt;" argument with
the server address this analyzer is reporting to as argument.
"prelude-admin" should be called for each configured server address.
</code></pre>

	<p>The default is to create the sensor profile using the UID and GID of the user who launched the prelude-admin command. If you want the profile to be run by another set of permission, use the <em>--uid</em> and <em>--gid</em> options.</p>


	<a name="Prelude-LML-Registration-example"></a>
<h2 >Prelude-LML Registration example<a href="#Prelude-LML-Registration-example" class="wiki-anchor">&para;</a></h2>


	<p>This is an example on registering <em>Prelude-LML</em> on host <em>lmlhost</em> to a <em>Prelude-Manager</em> running on host <em>managerhost</em>:</p>


<pre>
$ prelude-admin register prelude-lml "idmef:w admin:r" *managerhost*
Generating 1024 bits RSA private key... This might take a very long time.
[Increasing system activity will speed-up the process].
Generation in progress... X

</code></pre>

	<p><strong>Note</strong>: The first time an agent is registered, <strong>prelude-admin</strong> will need to create a private key for the agent. Under Linux, the operation can take a very long time due to the entropy generation system: advises on fixing this problem are available on the <a class="wiki-page" href="/projects/prelude/wiki/MiscEntropy">Misc/Entropy</a> page.</p>


	<p><em>prelude-admin</em> will then ask you to start another <em>prelude-admin</em> instance on the machine where the prelude-manager server is listening (<em>managerhost</em> in this example).</p>


<pre>
You now need to start "prelude-admin" registration-server on managerhost:
example: "prelude-admin registration-server prelude-manager" 

Enter the one-shot password provided on managerhost: 
</code></pre>

	<p>On <strong>managerhost</strong>, you now need to start <em>prelude-admin registration-server</em> command using the profile name used by your <em>Prelude-Manager</em>:</p>


<pre>
   $ prelude-admin registration-server prelude-manager

The "deadbeaf" password will be requested by "prelude-admin register" 
in order to connect. Please remove the quotes before using it.

Generating 1024 bits Diffie-Hellman key for anonymous authentication...++++++++++.+++++..++++++++++
Waiting for peers install request on 0.0.0.0:5553...
</code></pre>

	<p>As you can see, the generated password is <strong>deadbeaf</strong>. You need to enter this password in the <strong>lmlhost</strong> <em>prelude-admin</em> session:</p>


<pre>
Enter the one-shot password provided on localhost: [you don't see this, but deadbeaf is typed]
Confirm the one-shot password provided on localhost: [you don't see this, but deadbeaf is typed]

Connecting to registration server (localhost:5553)... Authentication succeeded.
Successful registration to localhost:5553.
</code></pre>

	<p>This is what you'll get on the server side:<br /><pre>
Connection from 127.0.0.1:52507...

Registration request for analyzerID="229348179011709" permission="idmef:w admin:r".
Approve registration? [y/n]: y
127.0.0.1:52507 successfully registered.
</code></pre></p>


	<p>The operation was successful! congratulations, you now have a sensor up and running.</p>


	<p></p>


<div id="wiki_extentions_footer">

	<p><em>© <a href="http://www.c-s.fr" class="external">CS GROUP</a> 2012-2020</em></p>


</div>
</div>








        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
<!-- Piwik -->
<noscript><p><img src="//www.prelude-siem.org/piwik/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
<script type="text/javascript">
  var piwik_site_id = '3';

  var _paq = _paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
  _paq.push(["setCookieDomain", "*.dev.prelude-ids.com"]);
  _paq.push(["setDomains", ["*.dev.prelude-ids.com","*.prelude-ids.org","*.prelude-siem.org","*.www.prelude-ids.org","*.www.prelude-siem.org", "*.vigilo-nms.org", "*.www.vigilo-nms.org"]]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//www.prelude-siem.org/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', piwik_site_id]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2017 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111535491-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111535491-5');
</script>
 


    <script type="text/javascript">


    </script>
    <script>
//<![CDATA[
wiki_extension_create_table_header();
//]]>
</script>


</body>
</html>
